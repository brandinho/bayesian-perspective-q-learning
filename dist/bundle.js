(function(t,e){'object'==typeof exports&&'undefined'!=typeof module?e():'function'==typeof define&&define.amd?define(e):e()})(this,function(){'use strict';function t(t,e){function a(){for(var a,s=[],l=1,r=1,i=0;i<e;i++){s.push([]);for(var p=0;p<t;p++)a=0==i?p==t-1?c:0==p?y:h:i>=u&&i<u+x&&p>=m&&p<m+g?k.reward:y,s[i].push({x:l,y:r,width:o,height:d,reward:a}),l+=o+n;l=1,r+=d+n}return s}function s(t){var e=w.selectAll('.row').data(t).enter().append('g').attr('class','row'),a=e.selectAll('.square').data(function(t){return t}).enter().append('rect').attr('class','square').attr('x',function(t){return t.x}).attr('y',function(t){return t.y}).attr('width',function(t){return t.width}).attr('height',function(t){return t.height}).style('fill',function(t){return v(t.reward)}).style('stroke','none').style('stroke-width',3),s=w.append('rect').attr('x',k.x).attr('y',k.y).attr('width',k.width).attr('height',k.height).style('fill','none').style('stroke','red').style('stroke-width',3).style('stroke-dasharray','4, 4')}function l(a,s,l,r,i){const p=2;for(var c=1,h=1,y=0;y<e;y++){for(var f=0;f<t;f++){if(0==y){if(f==t-1){a.append(function(){return r.documentElement.cloneNode(!0)}).attr('y',h+p).attr('x',c+p).attr('width',0.9*o).attr('height',0.9*o)}else if(0==f){a.append(function(){return s.documentElement.cloneNode(!0)}).attr('y',h+p).attr('x',c+p).attr('width',0.9*o).attr('height',0.9*o)}else{a.append(function(){return i.documentElement.cloneNode(!0)}).attr('y',h+p).attr('x',c+p).attr('width',0.9*o).attr('height',0.9*o)}}else if(y>=u&&y<u+x&&f>=m&&f<m+g){a.append(function(){return l.documentElement.cloneNode(!0)}).attr('y',h+p).attr('x',c+p).attr('width',0.9*o).attr('height',0.9*o)}c+=o+n}c=1,h+=d+n}}const r=parseInt(d3.select('#gameOutline').style('height')),i=parseInt(d3.select('#gameOutline').style('width')),n=2,o=E((i-(t-1)*n)/t),d=o,p=o+n,c=50,h=-c,y=-2,m=1,u=1,g=2,x=3;var f,k={x:m*p,y:u*p,width:(o+n)*g,height:(d+n)*x,reward:-15,click:0},v=d3.scaleLinear().range(['#ff6961','#eee','#66cc66']).domain([h,0,c]),w=d3.select('#gameOutline').append('svg').attr('width',`${i}px`).attr('height',`${r}px`);Promise.all([d3.xml('assets/start.svg'),d3.xml('assets/danger.svg'),d3.xml('assets/goal.svg'),d3.xml('assets/cliff.svg')]).then((t)=>{var e=t[0],r=t[1],i=t[2],n=t[3];f=a(),s(f),l(w,e,r,i,n)})}function e(t,e){var a,s,l,r=0;do a=2*Math.random()-1,s=2*Math.random()-1,l=a*a+s*s;while(1<=l);var i=_(-2*A(l)/l),r=a*i;return r*e+t}function a(t,e,a){return b(-L(t-e,2)/(2*L(a,2)))/(a*_(2*w))}function s(t){let e=0,a=0;for(;0==e;)e=t();for(;0==a;)a=t();const s=_(-2*A(e)),l=2*w*a;return[s*Math.cos(l),s*Math.sin(l)]}function l(t,e,a=0){const[l,r]=s(Math.random);if(0===a)return t+e*l;const i=a/_(1+a*a),n=i*l+_(1-i*i)*r,o=0<=l?n:-n;return t+e*o}function r(t,e,a){for(var l=[],r=0;r<t;r++)l.push(s(Math.random)[0]*a+e);return l}function i(t,e){for(var a=[],s=0;s<t;s++)a.push(l(0,1,e));return a}function o(t,e,a,s,r){for(var i,n=[],o=0;o<t;o++)i=o%e,n.push(l(a[i],s[i],r[i]));return n}function n(t,e,a){function s(t,e){for(var a=[],s=0;a.length<L;)a.push(d3.mean(t.slice(s,s+e))),s+=b;return a}function l(t,e){return e=e.slice().sort((t,e)=>t-e),d3.range(t).map((a)=>e[E(a*(e.length-1)/t)])}function d(t,e){for(var a=[],s=0;s<t.length;s++)a.push({x:t[s],y:e[s]});return a}function p(t,e){var a=d3.extent(t),s=d3.extent(e),l=d3.min([a[0],s[0]])-0.05,r=d3.max([a[1],s[1]])+0.05;return[l,r]}function c(t,e){var a=p(t,e),s=a[0],l=a[1];return[{x:s,y:s},{x:s+(l-s)/2,y:s+(l-s)/2},{x:l,y:l}]}function y(t){var e;return'weak'==t?e=i(A,D):'strong'==t&&(e=o(A,b,P,M,z)),e}function u(t,e){for(var a=[],s=0;s<t.length;)a.push(...t.slice(s,s+e)),s+=b;return a}function g(t,e){for(var a=0,s=0;s<t.length;s++)t[s].y=t[s].length/e,t[s].cum=a+t[s].y,a=t[s].cum,t[s].cum=t[s].cum}function x(){C=s(T,w),J=d3.histogram().domain(K.domain()).thresholds(K.ticks(v))(C),G=l(n,C),q=d3.mean(C),R=d3.deviation(C),H=r(L,q,R),N=l(n,H),U=c(N,G),I=d(N,G),yt.remove(),gt.remove(),xt.remove(),ft.remove(),g(J,C.length),yt=rt.append('path').datum(J).attr('d',ot).style('stroke',a).attr('class','line'),gt=it.append('path').datum(J).attr('d',dt).style('stroke',a).attr('class','line'),F=d3.scaleLinear().domain(p(N,G)).range([0,h]),Z=d3.scaleLinear().domain(p(N,G)).range([m,0]),et=d3.axisBottom(F).tickSize(0).tickValues([]),lt=d3.axisLeft(Z).tickSize(0).tickValues([]),nt.select('.xQQ').call(et),nt.select('.yQQ').call(lt),xt=nt.append('path').datum(U).attr('d',pt).style('stroke','black').attr('class','line'),ft=nt.append('g').selectAll('dot').data(I).enter().append('circle').attr('cx',function(t){return F(t.x)}).attr('cy',function(t){return Z(t.y)}).attr('r',5).style('fill',a).style('opacity',0.5)}function f(){'weak'==Q?B=T:'strong'==Q&&(B=u(T,w)),j=r(A,d3.mean(B),d3.deviation(B)/_(b)),O=d3.histogram().domain(K.domain()).thresholds(K.ticks(v))(B),Y=d3.histogram().domain(K.domain()).thresholds(K.ticks(v))(j),g(O,B.length),g(Y,j.length),ct.remove(),ht.remove(),mt.remove(),ut.remove(),ct=rt.append('path').datum(O).attr('d',ot).style('stroke',t).style('fill',t).style('fill-opacity',0.3).attr('class','line'),ht=rt.append('path').datum(Y).attr('d',ot).style('stroke',e).style('fill',e).style('fill-opacity',0.3).attr('class','line'),mt=it.append('path').datum(O).attr('d',dt).style('stroke',t).attr('class','line'),ut=it.append('path').datum(Y).attr('d',dt).style('stroke',e).attr('class','line')}var k={top:50,right:25,bottom:30,left:25},m=parseInt(d3.select('.column').style('height'))-k.top-k.bottom,h=parseInt(d3.select('.chart').style('width'))-k.left-k.right,v=20,w=+d3.select('#sliderSizeCLT').attr('value'),b=+d3.select('#sliderSizeCLT').attr('max'),L=500,A=b*L,n=100,D=5;document.querySelector('label[for="barSizeCLT"] span').innerHTML=w;var B,S=function(t){for(var e=0,a=0.5,s=2,l=[],r=[],i=[],n=0;n<t;n++)l.push(Math.random()*(3-e)+e),r.push(Math.random()*(1.5-a)+a),i.push(Math.random()*(6-s)+s);return[l,r,i]}(b),P=S[0],M=S[1],z=S[2],Q=d3.selectAll('input[name="CLT-scenarios"]:checked').property('value'),T=y(Q);'weak'==Q?B=T:'strong'==Q&&(B=u(T,w));var C=s(T,w),j=r(A,d3.mean(B),d3.deviation(B)/_(b)),G=l(n,C),q=d3.mean(C),R=d3.deviation(C),H=r(L,q,R),N=l(n,H),U=c(N,G),I=d(N,G),F=d3.scaleLinear().domain(p(N,G)).range([0,h]),K=d3.scaleLinear().domain(d3.extent(T)).range([0,h]),V=d3.scaleLinear().domain(d3.extent(T)).range([0,h]),O=d3.histogram().domain(K.domain()).thresholds(K.ticks(v))(B),J=d3.histogram().domain(K.domain()).thresholds(K.ticks(v))(C),Y=d3.histogram().domain(K.domain()).thresholds(K.ticks(v))(j);g(O,B.length),g(J,C.length),g(Y,j.length);var W=d3.scaleLinear().domain([0,d3.max(Y,function(t){return t.y})]).range([m,0]),X=d3.scaleLinear().domain([0,1]).range([m,0]),Z=d3.scaleLinear().domain(p(N,G)).range([m,0]),$=d3.axisBottom(K).ticks(4).tickSize(0).tickPadding(15),tt=d3.axisBottom(V).ticks(4).tickSize(0).tickPadding(15),et=d3.axisBottom(F).tickSize(0).tickValues([]),at=d3.axisLeft(W).ticks(4).tickSize(0).tickPadding(15),st=d3.axisLeft(X).ticks(4).tickSize(0).tickPadding(15),lt=d3.axisLeft(Z).tickSize(0).tickValues([]),rt=d3.select('#PDF').append('svg').attr('width',h+k.left+k.right).attr('height',m+k.top+k.bottom).append('g').attr('transform','translate('+k.left+','+k.top+')'),it=d3.select('#CDF').append('svg').attr('width',h+k.left+k.right).attr('height',m+k.top+k.bottom).append('g').attr('transform','translate('+k.left+','+k.top+')'),nt=d3.select('#QQ').append('svg').attr('width',h+k.left+k.right).attr('height',m+k.top+k.bottom).append('g').attr('transform','translate('+k.left+','+k.top+')'),ot=d3.area().x(function(t){return K(t.x0)}).y0(m).y1(function(t){return W(t.y)}).curve(d3.curveBasis),dt=d3.line().x(function(t){return V(t.x0)}).y(function(t){return X(t.cum)}).curve(d3.curveBasis),pt=d3.line().x(function(t){return F(t.x)}).y(function(t){return Z(t.y)}).curve(d3.curveBasis),ct=rt.append('path').datum(O).attr('d',ot).style('stroke',t).style('fill',t).style('fill-opacity',0.3).attr('class','line'),ht=rt.append('path').datum(Y).attr('d',ot).style('stroke',e).style('fill',e).style('fill-opacity',0.3).attr('class','line'),yt=rt.append('path').datum(J).attr('d',ot).style('stroke',a).attr('class','line'),mt=it.append('path').datum(O).attr('d',dt).style('stroke',t).attr('class','line'),ut=it.append('path').datum(Y).attr('d',dt).style('stroke',e).attr('class','line'),gt=it.append('path').datum(J).attr('d',dt).style('stroke',a).attr('class','line'),xt=nt.append('path').datum(U).attr('d',pt).style('stroke','black').attr('class','line'),ft=nt.append('g').selectAll('dot').data(I).enter().append('circle').attr('cx',function(t){return F(t.x)}).attr('cy',function(t){return Z(t.y)}).attr('r',5).style('fill',a).style('opacity',0.5);d3.select('#sliderSizeCLT').on('input',function(){w=+this.value,document.querySelector('label[for="barSizeCLT"] span').innerHTML=w,'strong'==Q&&f(),x()}),d3.selectAll('input[name="CLT-scenarios"]').on('change',function(){Q=this.value,T=y(Q),K=d3.scaleLinear().domain(d3.extent(T)).range([0,h]),V=d3.scaleLinear().domain(d3.extent(T)).range([0,h]),$=d3.axisBottom(K),tt=d3.axisBottom(V),rt.select('.xPDF').call($),it.select('.xCDF').call(tt),f(),x()});const kt=20,vt=20,wt=160,bt=20,Lt=30,_t=20,At=parseInt(d3.select('#cltLegend').style('height')),Et=bt;if(100==At){const t=10;var Dt=kt+t,Bt=kt+t,St=bt+Lt,Pt=kt+t,Mt=bt+2*Lt,zt=d3.select('#cltLegend').append('svg').attr('width',kt+wt)}else var Dt=kt,Bt=kt+wt+vt,St=bt,Pt=kt+2*wt+vt,Mt=bt,zt=d3.select('#cltLegend').append('svg').attr('width',2*(kt+wt)+120);zt.append('circle').attr('cx',Dt).attr('cy',Et).attr('r',6).style('fill',t),zt.append('circle').attr('cx',Bt).attr('cy',St).attr('r',6).style('fill',e),zt.append('circle').attr('cx',Pt).attr('cy',Mt).attr('r',6).style('fill',a);const Qt='#4C4845';zt.append('text').attr('x',Dt+_t).attr('y',Et).text('Underlying Distribution').style('font-size','12px').style('fill',Qt).attr('alignment-baseline','middle'),zt.append('text').attr('x',Bt+_t).attr('y',St).text('Normal Distribution').style('font-size','12px').style('fill',Qt).attr('alignment-baseline','middle'),zt.append('text').attr('x',Pt+_t).attr('y',Mt).text('Means Distribution').style('font-size','12px').style('fill',Qt).attr('alignment-baseline','middle'),rt.append('g').attr('class','xPDF axis').attr('transform','translate(0,'+m+')').call($),it.append('g').attr('class','xCDF axis').attr('transform',`translate(${0},${m})`).call(tt),nt.append('g').attr('class','xQQ axis').attr('transform',`translate(${0},${m})`).call(et),rt.append('g').attr('class','yPDF axis').call(at).append('text').attr('transform','rotate(-90)').attr('y',6).attr('dy','.71em').style('text-anchor','end').text('Count (Histogram)'),it.append('g').attr('class','yCDF axis').call(st).append('text').attr('transform','rotate(-90)').attr('y',6).attr('dy','.71em').style('text-anchor','end').text('CDF'),nt.append('g').attr('class','yQQ axis').call(lt).append('text').attr('transform','rotate(-90)').attr('y',6).attr('dy','.71em').style('text-anchor','end')}function d(t,e){function a(t,e){return t+e}function s(){for(var e,s,l,r,i,n=Math.round,o=Number.EPSILON,d='\\color{#696969}{w_',p=[],c=[],y=0;3>y;y++)l=n(1e3*(L(h,y)+o))/1e3,p.push(l),e='\\color{#696969}{\\gamma^'+(y+'=')+(l+'}'),i=document.querySelectorAll('#mixture-label'+(y+1+' d-math')),i[0].innerHTML=e;for(var t=p.reduce(a),y=0;3>y;y++)r=n(1e3*(p[y]/t+o))/10,c.push(r/100),s=d+(y+1+'=')+(r+'\\%}'),i=document.querySelectorAll('#mixture-label'+(y+1+' d-math')),i[1].innerHTML=s;return c}function r(t,e,a,s){for(var r=[],i=0;i<t;i++)r.push(l(e,a,s));return r}function i(t){for(var e,a,s,l=[],r=0;r<t[0].length;r++){e=t[0][r].x0,a=t[0][r].x0,s=0;for(var i=0;i<t.length;i++)s+=t[i][r].length*n[i];l.push({x0:e,x1:a,length:s})}return l}function o(){R.remove(),S=d3.scaleLinear().domain([0,d3.max(E,function(t){return t.length})]).range([p,0]),R=Q.append('path').datum(E).attr('d',C).style('stroke',e).style('stroke-width',2).attr('class','line')}var d={top:5,right:5,bottom:5,left:5},p=parseInt(d3.select('.individual-mixture').style('height'))-d.top-d.bottom,c=parseInt(d3.select('.individual-mixture').style('width'))-d.left-d.right,h=+d3.select('#sliderGammaMixture').attr('value'),y=20,m=5e3;document.querySelector('label[for="barGammaMixture"] span').innerHTML=h;var n=s(),u=r(m,-2,1,5),g=r(m,0,1,0),x=r(m,2,1,-5),f=d3.min([d3.min(u),d3.min(g),d3.min(x)]),k=d3.max([d3.max(u),d3.max(g),d3.max(x)]),v=d3.scaleLinear().domain([f,k]).range([0,c]),w=d3.histogram().domain(v.domain()).thresholds(v.ticks(y))(u),b=d3.histogram().domain(v.domain()).thresholds(v.ticks(y))(g),_=d3.histogram().domain(v.domain()).thresholds(v.ticks(y))(x),A=[w,b,_],E=i(A),D=d3.max([d3.max(w,function(t){return t.length}),d3.max(b,function(t){return t.length}),d3.max(_,function(t){return t.length})]),B=d3.scaleLinear().domain([0,D]).range([p,0]),S=d3.scaleLinear().domain([0,d3.max(E,function(t){return t.length})]).range([p,0]),P=d3.select('#mixture-dist1').append('svg').attr('width',c+d.left+d.right).attr('height',p+d.top+d.bottom).append('g').attr('transform','translate('+d.left+','+d.top+')'),M=d3.select('#mixture-dist2').append('svg').attr('width',c+d.left+d.right).attr('height',p+d.top+d.bottom).append('g').attr('transform','translate('+d.left+','+d.top+')'),z=d3.select('#mixture-dist3').append('svg').attr('width',c+d.left+d.right).attr('height',p+d.top+d.bottom).append('g').attr('transform','translate('+d.left+','+d.top+')'),Q=d3.select('#mixture').append('svg').attr('width',c+d.left+d.right).attr('height',p+d.top+d.bottom).append('g').attr('transform','translate('+d.left+','+d.top+')'),T=d3.line().x(function(t){return v(t.x0)}).y(function(t){return B(t.length)}).curve(d3.curveBasis),C=d3.line().x(function(t){return v(t.x0)}).y(function(t){return S(t.length)}).curve(d3.curveBasis),j=P.append('path').datum(w).attr('d',T).style('stroke',t).style('stroke-width',2).attr('class','line'),G=M.append('path').datum(b).attr('d',T).style('stroke',t).style('stroke-width',2).attr('class','line'),q=z.append('path').datum(_).attr('d',T).style('stroke',t).style('stroke-width',2).attr('class','line'),R=Q.append('path').datum(E).attr('d',C).style('stroke',e).style('stroke-width',2).attr('class','line');d3.select('#sliderGammaMixture').on('input',function(){h=+this.value,document.querySelector('label[for="barGammaMixture"] span').innerHTML=h,n=s(),E=i(A),o()})}function p(t,e,a,s){function l(t){var e,a,s,l,r,i;'true'==t['Shapiro-Wilk']?(e='\u2714',l='#32cd32'):(e='\u2718',l='red'),'true'==t['D\'Agostino\'s K^2']?(a='\u2714',r='#32cd32'):(a='\u2718',r='red'),'true'==t['Anderson-Darling']?(s='\u2714',i='#32cd32'):(s='\u2718',i='red'),document.getElementById('shapiro-result').innerHTML=e,document.getElementById('agostino-result').innerHTML=a,document.getElementById('anderson-result').innerHTML=s,document.getElementById('shapiro-result').style.color=l,document.getElementById('agostino-result').style.color=r,document.getElementById('anderson-result').style.color=i}function r(t,e,a){return t.reduce((t,a,s)=>t+L(e,s)*a,0)/a}function n(t,e,a){for(var s=[],l=0;s.length<k;)s.push(r(t.slice(l,l+x),e,a)),l+=f;return s}function o(t){for(var e,a=[],s=0;s<=f;s++)e=L(t,s),0==s?a.push({x:s,y:e}):a.push({x:s,y:a[a.length-1].y+e});return a}function d(t,e){for(var a=0;a<t.length;a++)t[a].y=t[a].length/e}function p(){D=o(u),P=n(S,u,D[x-1].y),C=d3.histogram().domain(z.domain()).thresholds(z.ticks(m))(P),d(C,P.length),Y.remove(),et.remove(),$.remove(),Y=I.append('path').datum(C).attr('d',K).style('stroke',a).style('fill',a).style('fill-opacity',0.3).attr('class','line'),$=F.append('line').attr('x1',Q(x)).attr('y1',0).attr('x2',Q(x)).attr('y2',y).style('stroke',s).style('stroke-width',2).style('class','line'),et=F.append('path').datum(D).attr('d',V).style('stroke',s).attr('class','line')}var c={top:50,right:10,bottom:50,left:50},y=parseInt(d3.select('.column').style('height'))-c.top-c.bottom,h=parseInt(d3.select('.chart').style('width'))-c.left-c.right,m=20,u=+d3.select('#sliderGammaQDistribution').attr('value'),g=+d3.select('#sliderGammaQDistribution').attr('max'),x=+d3.select('#sliderSizeQDistribution').attr('value'),f=+d3.select('#sliderSizeQDistribution').attr('max'),k=500;document.querySelector('label[for="barGammaQDistribution"] span').innerHTML=u,document.querySelector('label[for="barSizeQDistribution"] span').innerHTML=x;var v=t[`Sample Size: ${x}, Gamma: ${u}`];l(v);const w=[];for(var b=0;b<=f;b++)w.push({x:b,y:30});const _=o(0),A=o(1),E=[];for(var b=0;b<=f;b++)E.push({x:_[b].x,lower:_[b].y,upper:A[b].y});var D=o(u),B=o(g),S=t.Data,P=n(S,u,D[x-1].y),M=n(S,g,B[B.length-1].y),z=d3.scaleLinear().domain(d3.extent(S)).range([0,h]),Q=d3.scaleLinear().domain([0,D.length]).range([0,h]),T=d3.histogram().domain(z.domain()).thresholds(z.ticks(m))(S),C=d3.histogram().domain(z.domain()).thresholds(z.ticks(m))(P),j=d3.histogram().domain(z.domain()).thresholds(z.ticks(m))(M);d(T,S.length),d(C,P.length),d(j,M.length);var G=d3.scaleLinear().domain([0,d3.max(j,function(t){return t.y})]).range([y,0]).nice(),q=d3.scaleLinear().domain([0,f]).range([y,0]),R=d3.axisBottom(z),H=d3.axisBottom(Q),N=d3.axisLeft(G).ticks(7),U=d3.axisLeft(q),I=d3.select('#QDistribution').append('svg').attr('width',h+c.left+c.right).attr('height',y+c.top+c.bottom).append('g').attr('transform','translate('+c.left+','+c.top+')'),F=d3.select('#EffectiveSampleSize').append('svg').attr('width',h+c.left+c.right).attr('height',y+c.top+c.bottom).append('g').attr('transform','translate('+c.left+','+c.top+')'),K=d3.area().x(function(t){return z(t.x0)}).y0(y).y1(function(t){return G(t.y)}).curve(d3.curveBasis),V=d3.line().x(function(t){return Q(t.x)}).y(function(t){return q(t.y)}).curve(d3.curveBasis),O=d3.area().x(function(t){return Q(t.x)}).y0(function(t){return q(t.lower)}).y1(function(t){return q(t.upper)}).curve(d3.curveCardinal),J=I.append('path').datum(T).attr('d',K).style('stroke',e).style('fill',e).style('fill-opacity',0.3).attr('class','line'),Y=I.append('path').datum(C).attr('d',K).style('stroke',a).style('fill',a).style('fill-opacity',0.3).attr('class','line'),W=F.append('path').datum(_).attr('d',V).style('stroke',a).style('stroke-dasharray','3, 3').attr('class','line'),X=F.append('path').datum(A).attr('d',V).style('stroke',a).style('stroke-dasharray','3, 3').attr('class','line'),Z=F.append('path').datum(w).attr('d',V).style('stroke-dasharray','5, 5').style('stroke','red').attr('class','line'),$=F.append('line').attr('x1',Q(x)).attr('y1',0).attr('x2',Q(x)).attr('y2',y).style('stroke',s).style('stroke-width',2).style('class','line'),tt=F.append('path').datum(E).attr('d',O).style('fill',a).style('opacity',0.1),et=F.append('path').datum(D).attr('d',V).style('stroke',s).attr('class','line');d3.select('#sliderSizeQDistribution').on('input',function(){x=+this.value,document.querySelector('label[for="barSizeQDistribution"] span').innerHTML=x,v=t[`Sample Size: ${x}, Gamma: ${u}`],l(v),p()}),d3.select('#sliderGammaQDistribution').on('input',function(){u=+this.value,document.querySelector('label[for="barGammaQDistribution"] span').innerHTML=u,v=t[`Sample Size: ${x}, Gamma: ${u}`],l(v),p()}),I.append('g').attr('class','x axis').attr('transform','translate(0,'+y+')').call(R),F.append('g').attr('class','x axis').attr('transform',`translate(${0},${y})`).call(H),I.append('g').attr('class','y axis').call(N).append('text').attr('transform','rotate(-90)').attr('y',6).attr('dy','.71em').style('text-anchor','end').text('Count (Histogram)'),F.append('g').attr('class','y axis').call(U).append('text').attr('transform','rotate(-90)').attr('y',6).attr('dy','.71em').style('text-anchor','end').text('CDF')}function c(t,e,s){function l(t,e){for(var s=[],l=t-4*e;l<t+4*e;l+=(t+4*e-(t-4*e))/200)s.push({x:l,y:a(l,t,e)});return s}function r(t,e,a,s){return e/(e+s)*a+s/(e+s)*t}function i(t,e){return t*e/(t+e)}function n(){d3.select('.bayesian-prior').remove(),d3.select('.bayesian-likelihood').remove(),d3.select('.constant-prior').remove(),d3.select('.constant-likelihood').remove(),d3.select('.bayesian-posterior').remove(),d3.select('.constant-posterior').remove(),k=x/(1/u-1),v=f,w=f,b=k,L=k,B=l(v,b),S=l(g,x),P=l(w,L),M=l(g,x),U=d3.extent(B,C),I=d3.extent(P,C),O=d3.scaleLinear().domain([d3.min([U[0],F[0]]),d3.max([U[1],F[1]])]).range([G,0]).nice(),J=d3.scaleLinear().domain([d3.min([I[0],K[0]]),d3.max([I[1],K[1]])]).range([G,0]).nice(),Z=d3.axisLeft(O).ticks(6).tickSize(0).tickPadding(10),$=d3.axisLeft(J).ticks(6).tickSize(0).tickPadding(10),Y.select('.axis').transition().duration(_).ease(d3.easePoly).call(Z),W.select('.axis').transition().duration(_).ease(d3.easePoly).call($),at(B,t,'bayesian-prior',Y),at(S,e,'bayesian-likelihood',Y),at(P,t,'constant-prior',W),at(M,e,'constant-likelihood',W),A=0}var o,d,p,c,h={top:50,right:10,bottom:50,left:50},y=parseInt(d3.select('#bayesian-alpha-plot').style('width')),m=parseInt(d3.select('#bayesian-alpha-plot').style('height')),u=+d3.select('#sliderAlpha').attr('value'),g=1,x=3,f=4.5,k=x/(1/u-1),v=f,w=f,b=k,L=k,_=2e3,A=0;document.querySelector('label[for="barAlpha"] span').innerHTML=u;var E,D,B=l(v,b),S=l(g,x),P=l(w,L),M=l(g,x),z=d3.select('#bayesian-alpha-plot').append('svg').attr('width',`${y}px`).attr('height',`${m}px`),Q=d3.select('#constant-alpha-plot').append('svg').attr('width',`${y}px`).attr('height',`${m}px`);const T=(t)=>t.x,C=(t)=>t.y,j=y-h.left-h.right,G=m-h.top-h.bottom;var q=d3.extent(B,T),R=d3.extent(P,T),H=d3.extent(S,T),N=d3.extent(M,T),U=d3.extent(B,C),I=d3.extent(P,C),F=d3.extent(S,C),K=d3.extent(M,C);const V=d3.scaleLinear().domain([d3.min([q[0],R[0],H[0],N[0]]),d3.max([q[1],R[1],H[1],N[1]])]).range([0,j]).nice();var O=d3.scaleLinear().domain([d3.min([U[0],F[0]]),d3.max([U[1],F[1]])]).range([G,0]).nice(),J=d3.scaleLinear().domain([d3.min([I[0],K[0]]),d3.max([I[1],K[1]])]).range([G,0]).nice();const Y=z.append('g').attr('transform',`translate(${h.left},${h.top})`),W=Q.append('g').attr('transform',`translate(${h.left},${h.top})`),X=d3.axisBottom(V).ticks(6).tickSize(0).tickPadding(20);var Z=d3.axisLeft(O).ticks(6).tickSize(0).tickPadding(10),$=d3.axisLeft(J).ticks(6).tickSize(0).tickPadding(10);Y.append('g').attr('class','axis').call(Z),W.append('g').attr('class','axis').call($),Y.append('g').call(X).attr('transform',`translate(0,${G})`),W.append('g').call(X).attr('transform',`translate(0,${G})`),Y.append('text').attr('x',j/2).attr('y',0-h.top/2).attr('text-anchor','middle').style('font-size','16px').style('fill','#696969').text('Regular Bayesian Update'),W.append('text').attr('x',j/2).attr('y',0-h.top/2).attr('text-anchor','middle').style('font-size','16px').style('fill','#696969').text('Constant Alpha Update');const tt=d3.line().x((t)=>V(T(t))).y((t)=>O(C(t))).curve(d3.curveBasis),et=d3.line().x((t)=>V(T(t))).y((t)=>J(C(t))).curve(d3.curveBasis),at=(e,t,a,s)=>{function l(){var s=d3.scaleQuantile().domain([0,1]).range(d3.range(1,e.length+1));return function(l){if(a.includes('bayesian'))return tt(e.slice(0,s(l)));return a.includes('constant')?et(e.slice(0,s(l))):void 0}}const r=s.append('path').attr('stroke',t).attr('stroke-width',3).attr('fill','none').attr('class',a);a.includes('bayesian')?r.attr('d',tt(e)).transition().duration(_).attrTween('d',l):a.includes('constant')&&r.attr('d',et(e)).transition().duration(_).attrTween('d',l)};n(),Promise.all([d3.xml('assets/next.svg'),d3.xml('assets/refresh.svg')]).then((a)=>{var h=60,y=30,m=10,f=d3.select('#next-button').append('svg').attr('width',h).attr('height',h+y);f.append(function(){return a[0].documentElement.cloneNode(!0)}).attr('width',h).attr('y',-m).attr('class','probability-buttons').on('mouseover',function(){d3.select(this).style('cursor','pointer')}).on('mousedown',function(){f.selectAll('path').style('fill-opacity',0.7)}).on('mouseup',function(){f.selectAll('path').style('fill-opacity',1)}).on('click',function(){if(0!=A){d3.select('.bayesian-prior').remove();var e=d3.select('.bayesian-posterior').transition();v=o,b=p,B=l(v,b),e.duration(1e3).attr('stroke',t).attr('class','bayesian-prior'),d3.select('.constant-prior').remove();var a=d3.select('.constant-posterior').transition();w=d,L=c+L*u,P=l(w,L),a.duration(1e3).attr('stroke',t).attr('class','constant-prior').attr('d',et(P))}o=r(v,b,g,x),p=i(b,x),d=r(w,L,g,x),c=i(L,x),E=l(o,p),D=l(d,c);var n=d3.extent(E,C),h=d3.extent(D,C);O=d3.scaleLinear().domain([d3.min([U[0],F[0]]),n[1]]).range([G,0]).nice(),J=d3.scaleLinear().domain([d3.min([I[0],K[0]]),h[1]]).range([G,0]).nice(),Z=d3.axisLeft(O).ticks(6).tickSize(0).tickPadding(10),$=d3.axisLeft(J).ticks(6).tickSize(0).tickPadding(10),Y.select('.axis').transition().duration(_).ease(d3.easePoly).call(Z),W.select('.axis').transition().duration(_).ease(d3.easePoly).call($),0==A?(d3.select('.bayesian-prior').transition().duration(_).attr('d',tt(B)),d3.select('.constant-prior').transition().duration(_).attr('d',et(P))):(e.duration(_).attr('d',tt(B)),a.duration(_).attr('d',et(P))),d3.select('.bayesian-likelihood').transition().duration(_).attr('d',tt(S)),d3.select('.constant-likelihood').transition().duration(_).attr('d',et(M)),at(E,s,'bayesian-posterior',Y),at(D,s,'constant-posterior',W),A++});var k=d3.select('#refresh-button').append('svg').attr('width',h).attr('height',h+y);k.append(function(){return a[1].documentElement.cloneNode(!0)}).attr('width',h).attr('y',-m).attr('class','probability-buttons').on('mouseover',function(){d3.select(this).style('cursor','pointer')}).on('mousedown',function(){k.selectAll('path').style('fill-opacity',0.7)}).on('mouseup',function(){k.selectAll('path').style('fill-opacity',1)}).on('click',function(){n()});const z='#56ddd2';f.select('path:nth-child(1)').style('fill',z),f.select('path:nth-child(2)').style('fill',z),k.selectAll('path:nth-child(1)').style('fill',z),k.selectAll('path:nth-child(2)').style('fill',z);const Q='bold 10pt arial';f.append('text').text('Posterior').attr('x',h/2).attr('y',h+y-m).style('font',Q).attr('alignment-baseline','middle').style('text-anchor','middle'),k.append('text').text('Refresh').attr('x',h/2).attr('y',h+y-m).style('font',Q).attr('alignment-baseline','middle').style('text-anchor','middle');const T=20,j=12,q=20;var R=d3.select('#constantAlphaLegend').append('svg').attr('width',T+300);R.append('circle').attr('cx',T).attr('cy',j).attr('r',6).style('fill',t),R.append('circle').attr('cx',T+75).attr('cy',j).attr('r',6).style('fill',e),R.append('circle').attr('cx',T+215).attr('cy',j).attr('r',6).style('fill',s);const H='#4C4845';R.append('text').attr('x',T+q).attr('y',j).text('Prior').style('font-size','16px').style('fill',H).attr('alignment-baseline','middle'),R.append('text').attr('x',T+75+q).attr('y',j).text('Measurement').style('font-size','16px').style('fill',H).attr('alignment-baseline','middle'),R.append('text').attr('x',T+215+q).attr('y',j).text('Posterior').style('font-size','16px').style('fill',H).attr('alignment-baseline','middle')}),d3.select('#sliderAlpha').on('change',function(){u=+this.value,document.querySelector('label[for="barAlpha"] span').innerHTML=u,n()})}function h(t,e){const a={top:10,right:10,bottom:20,left:10},s=50,l=parseInt(d3.select('#EpsilonAlphaCorrelation').style('width')),r=parseInt(d3.select('#EpsilonAlphaCorrelation').style('height'))-s,n=l-a.left-a.right,o=r-a.top-a.bottom;var d=d3.selectAll('input[name="EpsilonAlpha-scenarios"]:checked').property('value'),p=parseInt(d3.select('#sliderNextQEpsilonAlpha').attr('value'));document.querySelector('label[for="barNextQEpsilonAlpha"] span').innerHTML=p;var c=d3.select('#EpsilonAlphaCorrelation').append('svg').attr('width',`${l}`).attr('height',`${r+s}`);const h=(l)=>{const r=(t)=>t.x,i=(t)=>t.epsilon,p=(t)=>t.alpha,h=d3.scaleLinear().domain(d3.extent(l,r)).range([0,n]);var d=d3.extent(l,i),y=d3.extent(l,p);const m=d3.scaleLinear().domain([d3.min([d[0],y[0]]),d3.max([d[1],y[1]])]).range([o,0]).nice(),u=c.append('g').attr('class','epsilon-alpha').attr('transform',`translate(${a.left},${a.top})`),g=d3.axisBottom(h).ticks(4).tickSize(-o).tickPadding(15),x=d3.axisLeft(m).ticks(4).tickSize(-n).tickPadding(10),f=u.append('g').call(x);f.append('text').attr('class','axis-label').attr('y',-0).attr('x',-o/2).attr('fill','black').attr('transform',`rotate(-90)`).attr('text-anchor','middle').text('');const k=u.append('g').call(g).attr('transform',`translate(0,${o})`);k.append('text').attr('class','axis-label').attr('y',s).attr('x',n/2).attr('fill','black').text('Episodes');const v=d3.line().x((t)=>h(r(t))).y((t)=>m(i(t))).curve(d3.curveBasis),w=d3.line().x((t)=>h(r(t))).y((t)=>m(p(t))).curve(d3.curveBasis);u.append('path').attr('class','line-path epsilon').style('stroke',t).attr('d',v(l)),u.append('path').attr('class','line-path alpha').style('stroke',e).attr('d',w(l)),c.selectAll('circle').raise(),c.selectAll('text').raise()},y=20,m=100,u=12,g=20;var x=d3.select('#epsilonAlphaLegend').append('svg').attr('width',y+m+70);x.append('circle').attr('cx',y).attr('cy',u).attr('r',6).style('fill',t),x.append('circle').attr('cx',y+m).attr('cy',u).attr('r',6).style('fill',e),x.append('text').attr('x',y+g).attr('y',u).text('Epsilon').style('font-size','16px').style('fill','#4C4845').attr('alignment-baseline','middle'),x.append('text').attr('x',y+m+g).attr('y',u).text('Alpha').style('font-size','16px').style('fill','#4C4845').attr('alignment-baseline','middle'),d3.select('#sliderNextQEpsilonAlpha').on('input',function(){p=+this.value,document.querySelector('label[for="barNextQEpsilonAlpha"] span').innerHTML=p,d3.select('.epsilon-alpha').remove(),h(f[d+' '+p])}),d3.selectAll('input[name="EpsilonAlpha-scenarios"]').on('change',function(){d=this.value,d3.select('.epsilon-alpha').remove(),h(f[d+' '+p])});for(var f={},k=[],v=-8;8>=v;v++)k.push(v);Promise.all([d3.json('data/epsilon_alpha.json'),d3.json('data/epsilon_alpha_noise.json')]).then((t)=>{for(var e,a=t[0],s=t[1],l=0;l<k.length;l++){e=k[l],f['No Noise '+e]=[],f['Noise '+e]=[];for(var r=0;r<a[e].epsilon.length;r++)f['No Noise '+e].push({x:r,epsilon:a[e].epsilon[r],alpha:a[e].alpha[r]}),f['Noise '+e].push({x:r,epsilon:s[e].epsilon[r],alpha:s[e].alpha[r]})}h(f[d+' '+p])})}function y(t,e,a,s,l){function r(r){const i=d3.scaleLinear().domain(d3.extent(r,g)).range([0,c]).nice();var n=d3.min(r,b),o=d3.min(r,L),d=d3.min(r,_),p=d3.min(r,A),y=d3.min(r,E),m=d3.max(r,D),x=d3.max(r,B),f=d3.max(r,S),k=d3.max(r,P),v=d3.max(r,M);const w=d3.scaleLinear().domain([d3.min([n,o,d,p,y]),d3.max([m,x,f,k,v])]).range([h,0]).nice(),z=d3.area().x((t)=>i(g(t))).y0((t)=>w(b(t))).y1((t)=>w(D(t))).curve(d3.curveBasis),Q=d3.area().x((t)=>i(g(t))).y0((t)=>w(L(t))).y1((t)=>w(B(t))).curve(d3.curveBasis),T=d3.area().x((t)=>i(g(t))).y0((t)=>w(_(t))).y1((t)=>w(S(t))).curve(d3.curveBasis),C=d3.area().x((t)=>i(g(t))).y0((t)=>w(A(t))).y1((t)=>w(P(t))).curve(d3.curveBasis),j=d3.area().x((t)=>i(g(t))).y0((t)=>w(E(t))).y1((t)=>w(M(t))).curve(d3.curveBasis),G=0.2;u.append('path').attr('class','area-path epsilon-greedy').style('fill',t).style('fill-opacity',G).attr('d',z(r)),u.append('path').attr('class','area-path epsilon-greedy-decay').style('fill',e).style('fill-opacity',G).attr('d',Q(r)),u.append('path').attr('class','area-path ucb').style('fill',a).style('fill-opacity',G).attr('d',T(r)),u.append('path').attr('class','area-path thompson').style('fill',s).style('fill-opacity',G).attr('d',C(r)),u.append('path').attr('class','area-path thompson-enhanced').style('fill',l).style('fill-opacity',G).attr('d',j(r))}const i={top:10,right:10,bottom:10,left:10},n=50,o=0,d=parseInt(d3.select('#Regret').style('width'))-o,p=parseInt(d3.select('#Regret').style('height'))-n,c=d-i.left-i.right,h=p-i.top-i.bottom;var y=d3.selectAll('input[name="regret"]:checked').property('value'),m=d3.select('#Regret').append('svg').attr('width',`${d+o}`).attr('height',`${p+n}`);const u=m.append('g').attr('class','regret').attr('transform',`translate(${i.left},${i.top})`),g=(t)=>t.x,x=(t)=>t.epsilonGreedyMedian,f=(t)=>t.epsilonGreedyDecayMedian,k=(t)=>t.ucbMedian,v=(t)=>t.thompsonMedian,w=(t)=>t.thompsonEnhancedMedian,b=(t)=>t.epsilonGreedyMin,L=(t)=>t.epsilonGreedyDecayMin,_=(t)=>t.ucbMin,A=(t)=>t.thompsonMin,E=(t)=>t.thompsonEnhancedMin,D=(t)=>t.epsilonGreedyMax,B=(t)=>t.epsilonGreedyDecayMax,S=(t)=>t.ucbMax,P=(t)=>t.thompsonMax,M=(t)=>t.thompsonEnhancedMax,z=(r)=>{function i(t,e,a,s,l,r){var i='legend-'+t;pt.append('circle').attr('cx',s).attr('cy',l).attr('class',i).attr('r',6).style('fill',a).on('mouseover',function(){d3.select(this).style('cursor','pointer')}).on('mouseout',function(){d3.select(this).style('cursor','default')});const n='#4C4845';pt.append('text').attr('x',s+$).attr('y',l).attr('class',i).text(e).style('font-size','12px').style('fill',n).attr('alignment-baseline','middle').on('mouseover',function(){d3.select(this).style('cursor','pointer')}).on('mouseout',function(){d3.select(this).style('cursor','default')}),pt.selectAll('.'+i).on('click',function(){var e=pt.selectAll('.'+i).nodes();0==r%2?(d3.selectAll('.'+t).style('opacity',0),d3.select(e[0]).style('opacity',0.3),d3.select(e[1]).style('fill','#dbdbdb')):1==r%2&&(d3.selectAll('.'+t).style('opacity',1),d3.select(e[0]).style('opacity',1),d3.select(e[1]).style('fill',n)),r+=1})}const p=d3.scaleLinear().domain(d3.extent(r,g)).range([0,c]).nice();var d=d3.min(r,b),y=d3.min(r,L),m=d3.min(r,_),z=d3.min(r,A),Q=d3.min(r,E),T=d3.max(r,D),C=d3.max(r,B),j=d3.max(r,S),G=d3.max(r,P),q=d3.max(r,M);const R=d3.scaleLinear().domain([d3.min([d,y,m,z,Q]),d3.max([T,C,j,G,q])]).range([h,0]).nice(),H=d3.line().x((t)=>p(g(t))).y((t)=>R(x(t))).curve(d3.curveBasis),N=d3.line().x((t)=>p(g(t))).y((t)=>R(f(t))).curve(d3.curveBasis),U=d3.line().x((t)=>p(g(t))).y((t)=>R(k(t))).curve(d3.curveBasis),I=d3.line().x((t)=>p(g(t))).y((t)=>R(v(t))).curve(d3.curveBasis),F=d3.line().x((t)=>p(g(t))).y((t)=>R(w(t))).curve(d3.curveBasis),K=d3.axisBottom(p).ticks(4).tickSize(-h).tickPadding(15).tickFormat(function(t){return 1<=t/1e3&&(t=t/1e3+'K'),t}),V=d3.axisLeft(R).ticks(4).tickSize(-c).tickPadding(10).tickFormat(function(t){return 1<=t/1e3&&(t=t/1e3+'K'),t}),O=u.append('g').call(V);O.append('text').attr('class','axis-label').attr('y',-o).attr('x',-h/2).attr('fill','black').attr('transform',`rotate(-90)`).attr('text-anchor','middle').text('');const J=u.append('g').call(K).attr('transform',`translate(0,${h})`);J.append('text').attr('class','axis-label').attr('y',n).attr('x',c/2).attr('fill','black').text('Episodes'),u.append('path').attr('class','line-path epsilon-greedy').style('stroke',t).attr('d',H(r)),u.append('path').attr('class','line-path epsilon-greedy-decay').style('stroke',e).attr('d',N(r)),u.append('path').attr('class','line-path ucb').style('stroke',a).attr('d',U(r)),u.append('path').attr('class','line-path thompson').style('stroke',s).attr('d',I(r)),u.append('path').attr('class','line-path thompson-enhanced').style('stroke',l).attr('d',F(r));const Y=10,W=160,X=20,Z=30,$=15,tt=parseInt(d3.select('#regretLegend').style('height'));if(110==tt){const t=10;var et=Y+t,at=Y+125,st=X,lt=Y+t,rt=X+Z,it=Y+180,nt=X+Z,ot=Y+t,dt=X+2*Z,pt=d3.select('#regretLegend').append('svg').attr('width',Y+2*W)}else var et=Y,at=Y+120,st=X,lt=Y+285,rt=X,it=Y,nt=X+Z,ot=Y+150,dt=X+Z,pt=d3.select('#regretLegend').append('svg').attr('width',2*(Y+W)+120);i('epsilon-greedy','Epsilon Greedy',t,et,X,0),i('epsilon-greedy-decay','Epsilon Greedy (Decay)',e,at,st,0),i('ucb','Upper Confidence Bound',a,lt,rt,0),i('thompson','Thompson Sampling',s,it,nt,0),i('thompson-enhanced','EQBF Thompson Sampling',l,ot,dt,0)},Q=['Epsilon Greedy','Epsilon Greedy Decay','Upper Confidence Bound','Thompson','Thompson Enhanced'];var T=[];Promise.all([d3.json('Data/regret_distribution.json')]).then((t)=>{for(var e=t[0],a=0;a<e[Q[0]+' median'].length;a++)T.push({x:a,epsilonGreedyMedian:e[Q[0]+' median'][a],epsilonGreedyDecayMedian:e[Q[1]+' median'][a],ucbMedian:e[Q[2]+' median'][a],thompsonMedian:e[Q[3]+' median'][a],thompsonEnhancedMedian:e[Q[4]+' median'][a],epsilonGreedyMax:e[Q[0]+' max'][a],epsilonGreedyDecayMax:e[Q[1]+' max'][a],ucbMax:e[Q[2]+' max'][a],thompsonMax:e[Q[3]+' max'][a],thompsonEnhancedMax:e[Q[4]+' max'][a],epsilonGreedyMin:e[Q[0]+' min'][a],epsilonGreedyDecayMin:e[Q[1]+' min'][a],ucbMin:e[Q[2]+' min'][a],thompsonMin:e[Q[3]+' min'][a],thompsonEnhancedMin:e[Q[4]+' min'][a]});z(T),r(T),d3.selectAll('.area-path').style('display','none')}),d3.selectAll('input[name="regret"]').on('change',function(){y=this.value,'range'==y?(d3.selectAll('.area-path').style('display','block'),d3.selectAll('.line-path').raise()):'median'==y&&d3.selectAll('.area-path').style('display','none')})}function m(t,e){function a(){for(var s=[],l=1,r=1,i=0;i<e;i++){s.push([]);for(var p=0;p<t;p++){if(0==i){if(p==t-1)var k=c;else if(0!=p)var k=h;else var k=y;}else if(i>=u&&i<u+x&&p>=m&&p<m+g)var k=f.reward;else var k=y;s[i].push({x:l,y:r,width:o,height:d,reward:k}),l+=o+n}l=1,r+=d+n}return s}function s(t,e,a){return b(-L(t-e,2)/(2*L(a,2)))/(a*_(2*w))}function l(t,e){var a=[];for(var l=t-C;l<t+C;l+=0.5)a.push({x:l,y:s(l,t,e)});return a}const r=parseInt(d3.select('#containerGridDistributions').style('height')),i=parseInt(d3.select('#containerGridDistributions').style('width')),n=2,o=E((i-(t-1)*n)/t),d=o,p=o+n,c=50,h=-c,y=-2,m=1,u=1,g=2,x=3;var f={x:m*p,y:u*p,width:(o+n)*g,height:(d+n)*x,reward:-15,click:0},k=d3.scaleLinear().range(['#ff6961','#eee','#66cc66']).domain([h,0,c]),a=a();const v=a[0][0].y,A=a[0][0].x,D=a[0][t-1].x,B=a[e-1][0].y,S=d3.select('body').append('g').attr('class','mytooltip');S.append('svg').attr('class','tooltipRobot');const P=['Up','Left','Right','Down'];var M={},z={};Promise.all([d3.json('data/Qmu.json'),d3.json('data/Qsigma.json')]).then((s)=>{for(var l,r=s[0],i=s[1],n=0;n<t;n++)for(var o=0;o<e;o++)for(var d of P)l='('+o+', '+n+') '+d,M[l]=r[l],z[l]=i[l]});var Q=50,T=-Q,C=30,j=d3.scaleLinear().range(['red','#F4C2C2','white','#B2EC5D','green']).domain([T,-1,0,1,Q]);const G=d3.select('.tooltipRobot'),q=function(t,e){function a(t,e){var a,s;return'x'==e?(a=p,s=[0,y]):'y'==e&&(a=c,s=[m,0]),d3.scaleLinear().domain(d3.extent(t,a)).range(s).nice()}function s(t,e,a,s){t.append('linearGradient').attr('id',s).attr('gradientUnits','userSpaceOnUse').attr('x1','0%').attr('y1','0%').attr('x2','100%').attr('y2','0%').selectAll('stop').data([{offset:'0%',color:j(e)},{offset:'50%',color:j((a-e)/2)},{offset:'100%',color:j(a)}]).enter().append('stop').attr('offset',function(t){return t.offset}).attr('stop-color',function(t){return t.color})}function r(t,e,l){const r=a(e,'x'),i=a(e,'y'),n=d3.line().x((t)=>r(p(t))).y((t)=>i(c(t))).curve(d3.curveBasis),o='distribution-gradient-'+l;return d3.select(`#${o}`).remove(),s(t,d3.min(e,(t)=>t.x),d3.max(e,(t)=>t.x),o),t.append('path').attr('stroke-width',3).attr('fill','none').attr('class','normal-distribution').attr('d',n(e)).attr('stroke',`url(#${o})`)}function i(t,e,a){return'('+(e-1)/(d+n)+', '+(t-1)/(o+n)+') '+a}const p=(t)=>t.x,c=(t)=>t.y,h={top:5,right:5,bottom:5,left:5},y=200/4,m=200/4,u=75,g=75,x=d3.scaleLinear().domain([T,Q]).range([0,y]).nice();if(G.selectAll('.normal-distribution').remove(),!1==(e==v&&t!=A)){if(e!=v){const a=i(t,e,'Up'),s=l(M[a],z[a]),n=G.append('g').attr('transform',`translate(${u},${h.top})`),o=r(n,s,'up')}if(t!=A){const a=i(t,e,'Left'),s=l(M[a],z[a]),n=G.append('g').attr('transform',`translate(${h.left},${g})`),o=r(n,s,'left')}if(t!=D){const a=i(t,e,'Right'),s=l(M[a],z[a]),n=G.append('g').attr('transform',`translate(${150-h.right},${g})`),o=r(n,s,'right')}if(e!=B){const a=i(t,e,'Down'),s=l(M[a],z[a]),n=G.append('g').attr('transform',`translate(${u},${150-h.bottom})`),o=r(n,s,'down')}}};var R=d3.select('#containerGridDistributions').append('svg').attr('width',`${i}px`).attr('height',`${r}px`),H=R.selectAll('.row').data(a).enter().append('g').attr('class','row'),N=H.selectAll('.square').data(function(t){return t}).enter().append('rect').attr('class','square').attr('x',function(t){return t.x}).attr('y',function(t){return t.y}).attr('width',function(t){return t.width}).attr('height',function(t){return t.height}).style('fill',function(t){return k(t.reward)}).style('stroke','none').style('stroke-width',3).on('mouseover',function(t){q(t.x,t.y),d3.select(this).style('stroke','#24B3A8').style('rx',5).style('cursor','pointer'),S.style('visibility','visible')}).on('mouseout',function(){d3.select(this).style('stroke','none').style('rx',0),S.style('visibility','hidden')}).on('mousemove',function(t){if(t.y>p*e/2)var a=-230;else var a=20;S.style('top',event.pageY+a+'px').style('left',event.pageX+-110+'px')}),U=R.append('rect').attr('x',f.x).attr('y',f.y).attr('width',f.width).attr('height',f.height).style('fill','none').style('stroke','red').style('stroke-width',3).style('stroke-dasharray','4, 4');const I=(t)=>{d3.select('.tooltipRobot').append(function(){return t.documentElement.cloneNode(!0)}).attr('x',60).attr('y',60)};d3.xml('assets/robotWithArrows.svg').then((t)=>{I(t)})}function u(t,e,a,s,l,r){function i(){for(var t=[],e=1,l=1,r=0;r<s;r++){t.push([]);for(var n=0;n<a;n++){if(0==r){if(n==a-1)var o=m;else if(0!=n)var o=u;else var o=g;}else if(r>=f&&r<f+v&&n>=x&&n<x+k)var o=w.reward;else var o=g;t[r].push({x:e,y:l,width:c,height:h,reward:o,click:0}),e+=c+p}e=1,l+=h+p}return t}function n(t,e){return`(${(e-1)/(h+p)}, ${(t-1)/(c+p)})`}const o=parseInt(d3.select('.learning-progress').style('height')),d=parseInt(d3.select('#gridLearningProgress').style('width')),p=2,c=E((d-(a-1)*p)/a),h=c,y=c+p,m=50,u=-m,g=-2,x=1,f=1,k=2,v=3;var w={x:x*y,y:f*y,width:(c+p)*k,height:(h+p)*v,reward:-15,click:0},b=d3.scaleLinear().range(['#ff6961','#eee','#66cc66']).domain([u,0,m]);const L=r,_=l,A=r,D=5,B={top:5,right:20,bottom:35,left:20},S=parseInt(d3.select('#chartLearningProgress').style('width')),P=35,M=S-B.left-B.right,z=o-B.top-B.bottom-0,Q=parseInt(d3.select('#actionsLearningProgress').style('width')),T=parseInt(d3.select('#actionsLearningProgress').style('height')),C=50,j=50;var G='(0, 0)',i=i(),q=d3.select('#gridLearningProgress').append('svg').attr('width',`${d}px`).attr('height',`${o}px`),R=d3.select('#chartLearningProgress').append('svg').attr('width',`${S+P}px`).attr('height',`${o}px`),H=d3.select('#actionsLearningProgress').append('svg').attr('width',`${Q}px`).attr('height',`${T}px`),N=q.selectAll('.row').data(i).enter().append('g').attr('class','row'),U=N.selectAll('.square').data(function(t){return t}).enter().append('rect').attr('class','square').attr('x',function(t){return t.x}).attr('y',function(t){return t.y}).attr('width',function(t){return t.width}).attr('height',function(t){return t.height}).style('fill',function(t){return b(t.reward)}).style('stroke',function(t){return n(t.x,t.y)==G?L:'none'}).style('rx',function(t){return n(t.x,t.y)==G?D:0}).style('stroke-width',3).on('mouseover',function(){d3.select(this).style('cursor','pointer')}).on('mouseout',function(){d3.select(this).style('cursor','default')}).on('click',function(e){G=n(e.x,e.y),e.click++,d3.selectAll('.square').style('stroke','none').style('rx',0),0==e.click%2?d3.select(this).style('stroke','none').style('rx',0):1==e.click%2&&d3.select(this).style('stroke',L).style('rx',D),d3.select('.QProgress').remove(),O(t[`${G} ${K}`]),e.click--}),I=q.append('rect').attr('x',w.x).attr('y',w.y).attr('width',w.width).attr('height',w.height).style('fill','none').style('stroke','red').style('stroke-width',3).style('stroke-dasharray','4, 4'),F=0,K='Down';const V=(e,a,s,l)=>{const r=H.append(function(){return e.documentElement.cloneNode(!0)}).attr('x',a+10).attr('y',s-T/2).attr('width',50).style('stroke-width',8).style('stroke',function(){return l==K?L:'none'}).attr('class','arrows').on('mouseover',function(){d3.select(this).style('cursor','pointer')}).on('mouseout',function(){d3.select(this).style('cursor','default')}).on('click',function(){K=l,F++,d3.selectAll('.arrows').style('stroke','none'),d3.selectAll('.arrows path').style('fill',A),0==F%2?d3.select(this).style('stroke','none'):1==F%2&&(d3.select(this).style('stroke',L),d3.select(this).selectAll('path').style('fill',_)),d3.select('.QProgress').remove(),O(t[`${G} ${K}`]),F--});r.selectAll('path').style('fill',function(){return l==K?_:A})};Promise.all([d3.xml('assets/upArrow.svg'),d3.xml('assets/leftArrow.svg'),d3.xml('assets/rightArrow.svg'),d3.xml('assets/downArrow.svg')]).then((t)=>{const e=t[0],a=t[1],s=t[2],l=t[3];V(e,C,-j,'Up'),V(a,0,0,'Left'),V(s,2*C,0,'Right'),V(l,C,j,'Down')});const O=(t)=>{const e=(t)=>t.x,a=(t)=>t.mu,s=(t)=>t.mu+t.sigma,l=(t)=>t.mu-t.sigma,i=d3.scaleLinear().domain(d3.extent(t,e)).range([0,M]).nice();var n=d3.extent(t,s),o=d3.extent(t,l),d=d3.extent(t,(t)=>t.true_mu+t.true_sigma),p=d3.extent(t,(t)=>t.true_mu-t.true_sigma);const c=d3.scaleLinear().domain([d3.min([o[0],p[0]]),d3.max([n[1],d[1]])]).range([z,0]).nice(),h=R.append('g').attr('class','QProgress').attr('transform',`translate(${B.left+P}, ${B.top})`),y=d3.axisBottom(i).ticks(5).tickSize(-z).tickPadding(15).tickFormat(function(t){return 1<=t/1e3&&(t=t/1e3+'K'),t}),m=d3.axisLeft(c).ticks(4).tickSize(-M).tickPadding(10),u=h.append('g').call(m);u.append('text').attr('class','axis-label').attr('y',-P).attr('x',-z/2).attr('fill','black').attr('transform',`rotate(-90)`).attr('text-anchor','middle').text('Q-Value');const g=h.append('g').call(y).attr('transform',`translate(0,${z})`),x=d3.line().x((t)=>i(e(t))).y((t)=>c(a(t))).curve(d3.curveBasis),f=d3.area().x((t)=>i(e(t))).y0((t)=>c(l(t))).y1((t)=>c(s(t))).curve(d3.curveBasis);h.append('path').attr('class','area-path').style('fill',r).style('fill-opacity',0.3).attr('d',f(t)),h.append('path').attr('class','line-path').style('stroke-width',2).style('stroke',r).attr('d',x(t))};O(t[`${G} ${K}`])}function g(t,e){function a(a){for(var s,l=[],r=1,i=1,n=0;n<e;n++){l.push([]);for(var c=0;c<t;c++)s='('+n+', '+c+')',l[n].push({x:r,y:i,width:d,height:p,optimal_visitations:a[s].optimal_visitations,suboptimal_visitations:a[s].suboptimal_visitations}),r+=d+o;r=1,i+=p+o}return l}function s(a,s){const l=2;for(var r=1,i=1,n=0;n<e;n++){for(var c=0;c<t;c++)if(1==n&&1==c){a.append(function(){return s.documentElement.cloneNode(!0)}).attr('y',i+l).attr('x',r+l).attr('width',0.9*d).attr('height',0.9*d)}r=1,i+=p+o}}function l(t,e){return`(${(e-1)/(p+o)}, ${(t-1)/(d+o)})`}function r(a,r,i){var g;'optimal_visitations'==i?g='#optimalStateVisitations':'suboptimal_visitations'==i&&(g='#suboptimalStateVisitations');var x,f=d3.select(g).append('svg').attr('width',`${c*t}`).attr('height',`${c*e}`);'optimal_visitations'==i?x=h:'suboptimal_visitations'==i&&(x=y,f.attr('x',`${n}`));var k=f.selectAll('.row').data(a).enter().append('g').attr('class','row'),v=k.selectAll('.square').data(function(t){return t}).enter().append('rect').attr('class','square').attr('x',function(t){return t.x}).attr('y',function(t){return t.y}).attr('width',function(t){return t.width}).attr('height',function(t){return t.height}).style('fill',function(t){return x(t[i])}).style('stroke','none').style('rx',function(t){return l(t.x,t.y)==u?m:0}).style('stroke-width',2);var w={x:1*c,y:1*c,width:(d+o)*2,height:(p+o)*3,reward:-15,click:0},b=f.append('rect').attr('x',w.x).attr('y',w.y).attr('width',w.width).attr('height',w.height).style('fill','none').style('stroke','red').style('stroke-width',3).style('stroke-dasharray','4, 4');s(f,r)}const i=parseInt(d3.select('.state-visitations').style('height')),n=parseInt(d3.select('.state-visitations').style('width')),o=2,d=E((n-(t-1)*o)/t),p=d,c=d+o;var h=d3.scaleLinear().range(['white','#66cc66']).domain([0,10000]),y=d3.scaleLinear().range(['white','#ff6961']).domain([0,10000]);const m=5;var u='(1, 0)',g={};Promise.all([d3.json('data/optimal_policy_state_visitations.json'),d3.json('data/suboptimal_policy_state_visitations.json'),d3.xml('assets/star.svg')]).then((s)=>{for(var l,i=s[0],n=s[1],o=s[2],d=0;d<t;d++)for(var p=0;p<e;p++)l='('+p+', '+d+')',g[l]={optimal_visitations:i[l].visitations,suboptimal_visitations:n[l].visitations};var c=a(g);r(c,o,'optimal_visitations'),r(c,o,'suboptimal_visitations')})}function x(t,e,s){function l(t,e){var a=l.canvas||(l.canvas=document.createElement('canvas')),s=a.getContext('2d');s.font=e;var r=s.measureText(t);return r.width}function r(t,e){for(var s=[],l=t-4*e;l<t+4*e;l+=0.05)s.push({mu:l,density:a(l,t,e)});return s}function i(t){const e=[];for(var a=0;a<=L;a++)e.push({x:t,y:a});return e}const n='bold 12pt arial',o='Probability Above',d=l(o,n),p='Joint Density',c=l(p,n),h=d3.max([d,c]),y=h-d3.min([d,c]);var m=20,u=parseInt(d3.select('.exploration-exploitation').style('height')),g=parseInt(d3.select('#distributionsExplorationExploitation').style('width')),x=parseInt(d3.select('.probability-bar').style('height')),f=parseInt(d3.select('.probability-bar').style('width'))-m-h,k=+d3.select('#sliderExplorationExploitation').attr('value'),v=1,w=1,b=10,L=10;document.querySelector('label[for="barExplorationExploitation"] span').innerHTML=k;var _=r(k,v),A=r(0,w),E=d3.scaleLinear().domain([-b-4*w,b+4*w]).range([0,g]),D=d3.scaleLinear().domain([0,1]).range([0,f]),B=d3.scaleLinear().domain([0,d3.max(A,function(t){return t.density})]).range([u,0]),S=d3.scaleLinear().domain([0,L]).range([x,0]),P=d3.axisBottom(E),M=d3.axisBottom(D),z=d3.axisLeft(B),Q=d3.axisLeft(S),T=d3.select('#distributionsExplorationExploitation').append('svg').attr('width',g).attr('height',u).attr('style','border-bottom: 1.5px solid grey;'),C=d3.select('#probAboveExplorationExploitation').append('g').attr('width',f+m+h).attr('height',x).append('text').text(o).style('font',n).attr('alignment-baseline','middle'),j=C.append('svg').attr('width',f).attr('height',x).attr('transform','translate('+m+','+0+')').attr('style','outline: 1.5px solid grey;'),G=d3.select('#probJointExplorationExploitation').append('g').attr('width',f+m+h).attr('height',x).append('text').text(p).style('font',n).attr('alignment-baseline','middle'),q=G.append('svg').attr('width',f).attr('height',x).attr('transform',`translate(${m+y},${0})`).attr('style','outline: 1.5px solid grey;'),R=d3.area().x(function(t){return E(t.mu)}).y0(u).y1(function(t){return B(t.density)}).curve(d3.curveBasis),H=d3.area().x0(0).x1(function(t){return D(t.x)}).y(function(t){return S(t.y)}).curve(d3.curveBasis),N=d3.line().x(function(t){return D(t.x)}).y(function(t){return S(t.y)}).curve(d3.curveBasis);Promise.all([d3.json('data/exploration_exploitation.json')]).then((a)=>{function l(){_=r(k,v),o=n[`${k}`].probability_above,d=n[`${k}`].probability_overlap,p=i(o),c=i(d),h.remove(),m.remove(),u.remove(),g.remove(),x.remove(),h=T.append('path').datum(_).attr('d',R).style('stroke',t).style('fill',t).style('fill-opacity',0.3).attr('class','line'),m=j.append('path').datum(p).attr('d',H).style('fill',e).style('fill-opacity',0.5),u=j.append('path').datum(p).attr('d',N).style('stroke',e).style('stroke-width',4).attr('class','line'),g=q.append('path').datum(c).attr('d',H).style('fill',e).style('fill-opacity',0.5),x=q.append('path').datum(c).attr('d',N).style('stroke',e).style('stroke-width',4).attr('class','line')}const n=a[0];var o=n[`${k}`].probability_above,d=n[`${k}`].probability_overlap,p=i(o),c=i(d),h=T.append('path').datum(_).attr('d',R).style('stroke',t).style('fill',t).style('fill-opacity',0.3).attr('class','line'),y=T.append('path').datum(A).attr('d',R).style('stroke',s).style('fill',s).style('fill-opacity',0.3).attr('class','line'),m=j.append('path').datum(p).attr('d',H).style('fill',e).style('fill-opacity',0.5),u=j.append('path').datum(p).attr('d',N).style('stroke',e).style('stroke-width',4).attr('class','line'),g=q.append('path').datum(c).attr('d',H).style('fill',e).style('fill-opacity',0.5),x=q.append('path').datum(c).attr('d',N).style('stroke',e).style('stroke-width',4).attr('class','line');d3.select('#sliderExplorationExploitation').on('input',function(){k=+this.value,document.querySelector('label[for="barExplorationExploitation"] span').innerHTML=k,l()})})}function f(t,e,s){function l(t,e){var a=l.canvas||(l.canvas=document.createElement('canvas')),s=a.getContext('2d');s.font=e;var r=s.measureText(t);return r.width}function r(t,e){for(var s=[],l=t-4*e;l<t+4*e;l+=0.05)s.push({mu:l,density:a(l,t,e)});return s}function i(t){const e=[];for(var a=0;a<=_;a++)e.push({x:t,y:a});return e}function n(t){for(var e=[],a=0;500>a;a++)e.push({e:a,mu_down:t[a].mu_down,sigma_down:t[a].sigma_down,mu_right:t[a].mu_right,sigma_right:t[a].sigma_right});return e}const o='bold 12pt arial',d='Probability Above',p=l(d,o),c='Joint Density',h=l(c,o),y=d3.max([p,h]),u=y-d3.min([p,h]);var g={top:50,right:20,bottom:50,left:50},m=20,x=parseInt(d3.select('.column').style('height'))-g.top-g.bottom,f=parseInt(d3.select('.chart').style('width'))-g.left-g.right,k=parseInt(d3.select('.probability-bar').style('height')),v=parseInt(d3.select('.probability-bar').style('width'))-m-y-g.right,w=+d3.select('#sliderInflectionEpisode').attr('value')-1,b=+d3.select('#sliderInflectionEpisode').attr('max')-1,L=50,_=10;document.querySelector('label[for="barInflectionEpisode"] span').innerHTML=w+1,Promise.all([d3.json('data/optimal_exploration_exploitation.json'),d3.json('data/suboptimal_exploration_exploitation.json')]).then((a)=>{function l(){S=_[`${w}`].mu_down,P=_[`${w}`].sigma_down,M=_[`${w}`].mu_right,z=_[`${w}`].sigma_right,Q=r(S,P),T=r(M,z),C=_[`${w}`].probability_above,j=_[`${w}`].probability_overlap,G=i(C),q=i(j),pt.remove(),ct.remove(),xt.remove(),ft.remove(),kt.remove(),vt.remove(),ht.remove(),yt.remove(),mt.remove(),ut.remove(),gt.remove(),pt=X.append('path').datum(Q).attr('d',st).attr('clip-path','url(#rect-clip)').style('stroke',t).style('fill',t).style('fill-opacity',0.3).attr('class','line'),ct=X.append('path').datum(T).attr('d',st).attr('clip-path','url(#rect-clip)').style('stroke',s).style('fill',s).style('fill-opacity',0.3).attr('class','line'),ht=Z.append('path').datum(A).attr('d',lt).style('stroke','none').style('fill',t).style('fill-opacity',0.15),yt=Z.append('path').datum(A).attr('d',rt).style('stroke','none').style('fill',s).style('fill-opacity',0.15),mt=Z.append('path').datum(A).attr('d',it).style('stroke',t).style('stroke-width',1.5).attr('class','line'),ut=Z.append('path').datum(A).attr('d',nt).style('stroke',s).style('stroke-width',1.5).attr('class','line'),gt=Z.append('line').attr('x1',H(w)).attr('y1',0).attr('x2',H(w)).attr('y2',x).style('stroke','black').style('stroke-width',2).style('class','line'),xt=tt.append('path').datum(G).attr('d',ot).style('fill',e).style('fill-opacity',0.5),ft=tt.append('path').datum(G).attr('d',dt).style('stroke',e).style('stroke-width',4).attr('class','line'),kt=at.append('path').datum(q).attr('d',ot).style('fill',e).style('fill-opacity',0.5),vt=at.append('path').datum(q).attr('d',dt).style('stroke',e).style('stroke-width',4).attr('class','line')}const p=a[0],h=a[1];var _,A,E=n(p),D=n(h),B=d3.selectAll('input[name = \'inflection-point\']').attr('value');'optimal'==B?(_=p,A=E):'suboptimal'==B&&(_=h,A=D);var S=_[`${w}`].mu_down,P=_[`${w}`].sigma_down,M=_[`${w}`].mu_right,z=_[`${w}`].sigma_right,Q=r(S,P),T=r(M,z),C=_[`${w}`].probability_above,j=_[`${w}`].probability_overlap,G=i(C),q=i(j),R=d3.scaleLinear().domain([-L,L]).range([0,f]).nice(),H=d3.scaleLinear().domain([0,b]).range([0,f]).nice(),N=d3.scaleLinear().domain([0,1]).range([0,v]),U=d3.scaleLinear().domain([0,0.1]).range([x,0]).nice(),I=d3.scaleLinear().domain([-50,50]).range([x,0]).nice(),F=d3.scaleLinear().domain([0,1]).range([k,0]),K=d3.axisBottom(R).ticks(5).tickSize(0).tickPadding(15),V=d3.axisBottom(H).ticks(5).tickSize(0).tickPadding(15).tickFormat(function(t){return 1<=t/1e3&&(t=t/1e3+'K'),t}),O=d3.axisBottom(N),J=d3.axisLeft(U).ticks(6).tickSize(0).tickPadding(15),Y=d3.axisLeft(I).ticks(6).tickSize(0).tickPadding(15),W=d3.axisLeft(F),X=d3.select('#distributionsInflectionPoint').append('svg').attr('width',f+g.left+g.right).attr('height',x+g.top+g.bottom).append('g').attr('transform','translate('+g.left+','+g.top+')');X.append('clipPath').attr('id','rect-clip').append('rect').attr('height',x).attr('width',f);var Z=d3.select('#progressInflectionPoint').append('svg').attr('width',f+g.left+g.right).attr('height',x+g.top+g.bottom).append('g').attr('transform','translate('+g.left+','+g.top+')'),$=d3.select('#probAboveInflectionPoint').append('g').attr('width',v+m+y+g.right).attr('height',k).append('text').text(d).style('font',o).attr('alignment-baseline','middle'),tt=$.append('svg').attr('width',v).attr('height',k).attr('transform',`translate(${m},${0})`).attr('style','outline: 1.5px solid grey;'),et=d3.select('#probJointInflectionPoint').append('g').attr('width',v+m+y+g.right).attr('height',k).append('text').text(c).style('font',o).attr('alignment-baseline','middle'),at=et.append('svg').attr('width',v).attr('height',k).attr('transform',`translate(${m+u},${0})`).attr('style','outline: 1.5px solid grey;'),st=d3.line().x(function(t){return R(t.mu)}).y(function(t){return U(t.density)}).curve(d3.curveBasis),lt=d3.area().x(function(t){return H(t.e)}).y0(function(t){return I(t.mu_down-t.sigma_down)}).y1(function(t){return I(t.mu_down+t.sigma_down)}).curve(d3.curveBasis),rt=d3.area().x(function(t){return H(t.e)}).y0(function(t){return I(t.mu_right-t.sigma_right)}).y1(function(t){return I(t.mu_right+t.sigma_right)}).curve(d3.curveBasis),it=d3.line().x(function(t){return H(t.e)}).y(function(t){return I(t.mu_down)}).curve(d3.curveBasis),nt=d3.line().x(function(t){return H(t.e)}).y(function(t){return I(t.mu_right)}).curve(d3.curveBasis),ot=d3.area().x0(0).x1(function(t){return N(t.x)}).y(function(t){return F(t.y)}).curve(d3.curveBasis),dt=d3.line().x(function(t){return N(t.x)}).y(function(t){return F(t.y)}).curve(d3.curveBasis),pt=X.append('path').datum(Q).attr('d',st).attr('clip-path','url(#rect-clip)').style('stroke',t).style('fill',t).style('fill-opacity',0.3).attr('class','line'),ct=X.append('path').datum(T).attr('d',st).attr('clip-path','url(#rect-clip)').style('stroke',s).style('fill',s).style('fill-opacity',0.3).attr('class','line'),ht=Z.append('path').datum(A).attr('d',lt).style('stroke','none').style('fill',t).style('fill-opacity',0.15),yt=Z.append('path').datum(A).attr('d',rt).style('stroke','none').style('fill',s).style('fill-opacity',0.15),mt=Z.append('path').datum(A).attr('d',it).style('stroke',t).style('stroke-width',1.5).attr('class','line'),ut=Z.append('path').datum(A).attr('d',nt).style('stroke',s).style('stroke-width',1.5).attr('class','line'),gt=Z.append('line').attr('x1',H(w)).attr('y1',0).attr('x2',H(w)).attr('y2',x).style('stroke','black').style('stroke-width',2).style('class','line'),xt=tt.append('path').datum(G).attr('d',ot).style('fill',e).style('fill-opacity',0.5),ft=tt.append('path').datum(G).attr('d',dt).style('stroke',e).style('stroke-width',4).attr('class','line'),kt=at.append('path').datum(q).attr('d',ot).style('fill',e).style('fill-opacity',0.5),vt=at.append('path').datum(q).attr('d',dt).style('stroke',e).style('stroke-width',4).attr('class','line');d3.select('#sliderInflectionEpisode').on('input',function(){w=+this.value-1,document.querySelector('label[for="barInflectionEpisode"] span').innerHTML=w+1,l()}),d3.selectAll('input[name = \'inflection-point\']').on('change',function(){B=this.value,console.log(B),'optimal'==B?(_=p,A=E):'suboptimal'==B&&(_=h,A=D),l()});const wt=20,bt=100,Lt=12,_t=20;var At=d3.select('#inflectionLegend').append('svg').attr('width',wt+bt+70);At.append('circle').attr('cx',wt).attr('cy',Lt).attr('r',6).style('fill',t),At.append('circle').attr('cx',wt+bt).attr('cy',Lt).attr('r',6).style('fill',s);const Et='#4C4845';At.append('text').attr('x',wt+_t).attr('y',Lt).text('Down').style('font-size','16px').style('fill',Et).attr('alignment-baseline','middle'),At.append('text').attr('x',wt+bt+_t).attr('y',Lt).text('Right').style('font-size','16px').style('fill',Et).attr('alignment-baseline','middle'),X.append('g').attr('class','x axis').attr('transform','translate(0,'+x+')').call(K),Z.append('g').attr('class','x axis').attr('transform','translate(0,'+x+')').call(V),X.append('g').attr('class','y axis').call(J).append('text').attr('transform','rotate(-90)').attr('y',6).attr('dy','.71em').style('text-anchor','end'),Z.append('g').attr('class','y axis').call(Y).append('text').attr('transform','rotate(-90)').attr('y',6).attr('dy','.71em').style('text-anchor','end')})}function k(t,s,a,l,r){function i(t,e){U.append(function(){return t.documentElement.cloneNode(!0)}).attr('y',e[0]*x+f).attr('x',e[1]*x+f).attr('width',0.9*u).attr('height',0.9*u)}function n(e,a){var l=!0;return'Up'==a&&0>e[0]?l=!1:'Left'==a&&0>e[1]?l=!1:'Right'==a&&e[1]>t-1?l=!1:'Down'==a&&e[0]>s-1&&(l=!1),l}function o(t,a,s){const l=`(${t[0]}, ${t[1]}) `,r=e(a[l+'Up'],s[l+'Up']),i=e(a[l+'Left'],s[l+'Left']),o=e(a[l+'Right'],s[l+'Right']),d=e(a[l+'Down'],s[l+'Down']);var p,c;const h=d3.max([r,i,o,d]);return r==h?(p=[t[0]-1,t[1]],c='Up'):i==h?(p=[t[0],t[1]-1],c='Left'):o==h?(p=[t[0],t[1]+1],c='Right'):d==h&&(p=[t[0]+1,t[1]],c='Down'),n(p,c)?p:t}function d(e,a,l){for(var r=e,i=[r],n=!1;!n;)0==r[0]&&r[1]==t-1?n=!0:0==r[0]&&0!=r[1]?n=!0:i.length==t*s?n=!0:(r=o(r,a,l),i.push(r));return i}function p(e){N.append('path').datum(e).attr('d',Z).style('stroke',X).style('stroke-width',10).style('fill','none').style('opacity',0.35).attr('class','agent-path').transition().duration(q).attrTween('d',function(){var a=d3.scaleQuantile().domain([0,1]).range(d3.range(1,e.length+1));return function(s){return Z(e.slice(0,a(s)))}})}function c(t,e,a){for(var s,l,r=0;r<G;r++)s=q*r-0.1*q,setTimeout(function(){l=d(t,e,a),p(l)},s)}const h=parseInt(d3.select('#containerInflectionPointPaths').style('height')),y=parseInt(d3.select('#containerInflectionPointPaths').style('width')),m=2,u=E((y-(t-1)*m)/t),g=u,x=u+m,f=3,k=50,v=-k,w=-2,b=1,L=1,_=2,A=3;var D={x:b*x,y:L*x,width:(u+m)*_,height:(g+m)*A,reward:-15,click:0},B=d3.scaleLinear().range(['#ff6961','#eee','#66cc66']).domain([v,0,k]);const S=r,P=a,M=l,z=0.8*u;var Q=[1,0];const T=['Up','Left','Right','Down'];var C={},j={},G=10;const q=1e3;var R,H=function(){for(var e,a=[],l=1,r=1,i=0;i<s;i++){a.push([]);for(var n=0;n<t;n++)e=0==i?n==t-1?k:0==n?w:v:i>=L&&i<L+A&&n>=b&&n<b+_?D.reward:w,a[i].push({x:l,y:r,width:u,height:g,reward:e}),l+=u+m;l=1,r+=g+m}return a}(),N=d3.select('#containerInflectionPointPaths').append('svg').attr('width',`${x*t+20+2*50+z}`).attr('height',`${x*s}`),U=N.append('svg').append('svg').attr('width',`${x*t}`).attr('height',`${x*s}`),I=U.selectAll('.row').data(H).enter().append('g').attr('class','row'),F=I.selectAll('.square').data(function(t){return t}).enter().append('rect').attr('class','square').attr('x',function(t){return t.x}).attr('y',function(t){return t.y}).attr('width',function(t){return t.width}).attr('height',function(t){return t.height}).style('fill',function(t){return B(t.reward)}).style('stroke','none'),K=U.append('rect').attr('x',D.x).attr('y',D.y).attr('width',D.width).attr('height',D.height).style('fill','none').style('stroke','red').style('stroke-width',3).style('stroke-dasharray','4, 4'),V=0,O=[2,0];const J=(t,e,a,s)=>{const l=N.append(function(){return t.documentElement.cloneNode(!0)}).attr('x',e).attr('y',a).attr('width',z).style('stroke-width',8).style('stroke',function(){return s==R?S:'none'}).attr('class','paths-arrow').on('mouseover',function(){d3.select(this).style('cursor','pointer')}).on('mouseout',function(){d3.select(this).style('cursor','default')}).on('click',function(){R=s,V++,d3.selectAll('.paths-arrow').style('stroke','none'),d3.selectAll('.paths-arrow path').style('fill',M),0==V%2?d3.select(this).style('stroke','none'):1==V%2&&(d3.select(this).style('stroke',S),d3.select(this).selectAll('path').style('fill',P)),'Right'==R?O=[1,1]:'Down'==R&&(O=[2,0]),d3.selectAll('.agent-path').remove(),c(O,C,j),V--,setTimeout(function(){d3.selectAll('.paths-arrow').raise()},q*G)});l.selectAll('path').style('fill',function(){return s==R?P:M})};var Y=d3.scaleLinear().domain([0,t]).range([0,x*t]),W=d3.scaleLinear().domain([s,0]).range([x*s,0]);const X=a;var Z=d3.line().x(function(t){return Y(t[1]+0.5)}).y(function(t){return W(t[0]+0.5)}).curve(d3.curveBasis);Promise.all([d3.json('data/suboptimal_Qmu.json'),d3.json('data/suboptimal_Qsigma.json')]).then((e)=>{for(var l,r=e[0],n=e[1],o=0;o<t;o++)for(var d=0;d<s;d++)for(var p of T)l='('+d+', '+o+') '+p,C[l]=r[l],j[l]=n[l];Promise.all([d3.xml('assets/robot.svg'),d3.xml('assets/rightArrow.svg'),d3.xml('assets/downArrow.svg')]).then((t)=>{var e=t[0],a=t[1],s=t[2];i(e,Q),J(a,u+2,-130+g+d3.max([g-33,0]),'Right'),J(s,4,-130+2*g+d3.max([g-35,0]),'Down')})})}function v(t,a,s,l,r,i){function n(t){for(var a,r=[],i=1,n=1,o=0;o<l;o++){r.push([]);for(var d=0;d<s;d++)0==o?d==s-1?a=w:0==d?'start'==t?a=L:'update'==t&&(a=e(L,_)):a=b:o>=S&&o<S+M&&d>=B&&d<B+P?'start'==t?a=z.reward:'update'==t&&(a=e(A,D)):'start'==t?a=L:'update'==t&&(a=e(L,_)),r[o].push({x:i,y:n,width:x,height:f,reward:a}),i+=x+g;i=1,n+=f+g}return r}function o(t){var e=R.selectAll('.row').data(t).enter().append('g').attr('class','row'),a=e.selectAll('.square').data(function(t){return t}).enter().append('rect').attr('class','square').attr('x',function(t){return t.x}).attr('y',function(t){return t.y}).attr('width',function(t){return t.width}).attr('height',function(t){return t.height}).style('fill',function(t){return Q(t.reward)}).style('stroke','none').style('stroke-width',3),s=R.append('rect').attr('x',z.x).attr('y',z.y).attr('width',z.width).attr('height',z.height).style('fill','none').style('stroke','red').style('stroke-width',3).style('stroke-dasharray','4, 4')}function d(t,e){var a=!0;return'Up'==e&&0>t[0]?a=!1:'Left'==e&&0>t[1]?a=!1:'Right'==e&&t[1]>s-1?a=!1:'Down'==e&&t[0]>l-1&&(a=!1),a}function p(t,a){const s=`(${t[0]}, ${t[1]}) `;if('explore'==T)var l=e(a[s+'Up'][U].mu,a[s+'Up'][U].sigma),r=e(a[s+'Left'][U].mu,a[s+'Left'][U].sigma),i=e(a[s+'Right'][U].mu,a[s+'Right'][U].sigma),n=e(a[s+'Down'][U].mu,a[s+'Down'][U].sigma);else if('exploit'==T)var l=a[s+'Up'][U].mu,r=a[s+'Left'][U].mu,i=a[s+'Right'][U].mu,n=a[s+'Down'][U].mu;var o,p;const c=d3.max([l,r,i,n]);return l==c?(o=[t[0]-1,t[1]],p='Up'):r==c?(o=[t[0],t[1]-1],p='Left'):i==c?(o=[t[0],t[1]+1],p='Right'):n==c&&(o=[t[0]+1,t[1]],p='Down'),d(o,p)?o:t}function c(t){for(var e,a=H,r=[a],i=!1;!i;)0==a[0]&&a[1]==s-1?(i=!0,e='You Win!!'):0==a[0]&&0!=a[1]?(i=!0,e='You Lose...'):r.length==s*l?(i=!0,e='You Timed Out!'):(a=p(a,t),r.push(a));return[r,e]}function h(){I.select('rect').attr('fill',r),I.select('text').text('Play')}function y(){C&&d3.xml('assets/robot.svg').then((e)=>{C=!1,N(e,t)})}const m=parseInt(d3.select('#containerGame').style('height')),u=parseInt(d3.select('#containerGame').style('width')),g=2,x=E((u-(s-1)*g)/s),f=x,k=x+g,v=3,w=50,b=-w,L=-2,_=2,A=-15,D=15,B=1,S=1,P=2,M=3;var z={x:B*k,y:S*k,width:(x+g)*P,height:(f+g)*M,reward:A,click:0},Q=d3.scaleLinear().range(['#ff6961','#eee','#66cc66']).domain([b,0,w]),T=d3.selectAll('input[name="game-explore-exploit"]:checked').property('value'),C=!0,j=n('start');const G=2*x,q=20;var R=d3.select('#containerGame').append('svg').attr('width',`${(x+g)*s+G+q}px`).attr('height',`${(f+g)*l}px`);o(j);var H=[0,0];const N=(t,e)=>{const a=t.documentElement.cloneNode(!0);var r=R.append(function(){return a}).attr('y',H[0]*k+v).attr('x',H[1]*k+v).attr('width',0.9*x).attr('height',0.9*x),d=c(e),p=d[0],y=d[1],m=0;const i=function(){m++,m<p.length?(R.remove(),R=d3.select('#containerGame').append('svg').attr('width',`${(x+g)*s+G+q}px`).attr('height',`${(f+g)*l}px`),j=n('update'),o(j),r=R.append(function(){return a}).attr('y',p[m-1][0]*k+v).attr('x',p[m-1][1]*k+v).attr('width',0.9*x).attr('height',0.9*x),r.transition().duration(500).attr('y',p[m][0]*k+v).attr('x',p[m][1]*k+v).on('end',i)):(h(),r.remove(),R.append('text').attr('class','game-end-text').attr('x',(x+g)*s/2).attr('y',(f+g)*l/2),R.selectAll('.game-end-text').text(y),C=!0)};i()};var U=+d3.select('#sliderEpisodesGame').attr('value')-1;document.querySelector('label[for="barEpisodesGame"] span').innerHTML=U+1,d3.select('#sliderEpisodesGame').on('input',function(){U=+this.value-1,document.querySelector('label[for="barEpisodesGame"] span').innerHTML=U+1}),d3.selectAll('input[name="game-explore-exploit"]').on('change',function(){T=this.value});var I=d3.select('#playButton').append('svg');(function(){I.append('rect').attr('fill',r).attr('width',`${G}`).attr('height',`${G/2}`).attr('rx',10).on('click',function(){R.selectAll('.game-end-text').remove(),d3.select(this).attr('fill',i),I.select('text').text('Playing...'),y()}),I.append('text').text('Play').attr('class','button-text').attr('x',`${G/2}`).attr('y',`${G/4}`)})()}var w=Math.PI,b=Math.exp,L=Math.pow,_=Math.sqrt,A=Math.log,E=Math.floor;window.onload=function(){const e=['#156760','#1D8D84','#24B3A8','#30D5C8','#56DDD2','#7CE4DC','#A2ECE6'];n(e[6],e[2],e[1]),d(e[5],e[1]),c(e[6],e[2],e[0]),h(e[5],e[1]),y(e[5],e[1],'#FCB97D','#EF767A','#456990'),Promise.all([d3.json('data/normality_tests.json')]).then((t)=>{p(t[0],e[5],e[2],e[1])});const s=['Up','Left','Right','Down'],l=10,r=6;t(l,r),m(l,r),g(l,r),x(e[4],e[2],e[1]),f(e[4],e[2],e[1]),k(l,r,e[5],e[2],e[0]);var i={};Promise.all([d3.json('data/Qmu_historical.json'),d3.json('data/Qsigma_historical.json'),d3.json('data/Qmu_true.json'),d3.json('data/Qsigma_true.json')]).then((t)=>{for(var n,o=t[0],d=t[1],p=t[2],c=t[3],h=0;h<l;h++)for(var y=0;y<r;y++)for(var m of s){n='('+y+', '+h+') '+m,i[n]=[];for(var a=0;a<o[n].length;a++)i[n].push({x:o[n][a].x,mu:o[n][a].y,sigma:d[n][a].y,true_mu:p[n],true_sigma:c[n]})}u(i,s,l,r,e[5],e[2]),v(i,s,l,r,e[3],e[6])})}});
//# sourceMappingURL=bundle.js.map
